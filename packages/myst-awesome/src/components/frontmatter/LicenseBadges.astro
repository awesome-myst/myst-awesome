---
/**
 * LicenseBadges component for MyST frontmatter
 * Displays license badges using Creative Commons and other license icons
 * Props:
 * - license: License object or array from frontmatter
 */
const { license } = Astro.props;

// Normalize license to array
const licenses = Array.isArray(license) ? license : [license];

// Helper function to get CC icon name from license ID
function getCCIconName(licenseId: string) {
  const ccMatch = /^(CC[^-]*(?:-[A-Z0-9]+)*)/i.exec(licenseId);
  if (!ccMatch) return null;
  
  const ccType = ccMatch[1].toLowerCase();
  const iconMap: Record<string, string> = {
    'cc': 'cc',
    'cc-by': 'cc-by',
    'cc-nc': 'cc-nc', 
    'cc-nd': 'cc-nd',
    'cc-sa': 'cc-sa',
    'cc-zero': 'cc-zero'
  };
  
  return iconMap[ccType] || 'cc';
}

// Helper function to check if license is Creative Commons
function isCreativeCommons(licenseObj: any) {
  return licenseObj.CC || (licenseObj.id && licenseObj.id.toLowerCase().startsWith('cc'));
}

// Helper function to check if license is OSI approved
function isOSIApproved(licenseObj: any) {
  return licenseObj.osi || licenseObj.OSI;
}
---

{licenses && licenses.length > 0 && (
  <div style="margin-bottom: var(--wa-space-l);">
    <h4 style="font-size: var(--wa-font-size-small); font-weight: var(--wa-font-weight-semibold); color: var(--wa-color-neutral-700); margin-bottom: var(--wa-space-s);">License</h4>
    <div style="display: flex; flex-wrap: wrap; gap: var(--wa-space-s);">
      {licenses.map((lic: any) => {
        if (!lic) return null;
        
        const licenseUrl = lic.url || (lic.id ? `https://creativecommons.org/licenses/${lic.id.toLowerCase()}/4.0/` : '#');
        const licenseName = lic.name || lic.title || lic.id || 'Unknown License';
        
        return (
          <a 
            href={licenseUrl}
            target="_blank"
            rel="noopener noreferrer"
            style="display: inline-flex; align-items: center; gap: var(--wa-space-xs); padding: var(--wa-space-xs) var(--wa-space-s); background: var(--wa-color-neutral-100); border-radius: var(--wa-border-radius); font-size: var(--wa-font-size-small); text-decoration: none; color: var(--wa-color-neutral-900); transition: background-color 0.2s;"
            title={licenseName}
            onmouseover="this.style.backgroundColor='var(--wa-color-neutral-200)'"
            onmouseout="this.style.backgroundColor='var(--wa-color-neutral-100)'"
          >
            {isCreativeCommons(lic) && getCCIconName(lic.id) && (
              <wa-icon 
                library="scienceicons" 
                name={getCCIconName(lic.id)} 
                style="font-size:1rem;" 
              />
            )}
            {isOSIApproved(lic) && (
              <wa-icon 
                library="scienceicons" 
                name="osi" 
                style="font-size:1rem;" 
              />
            )}
            <span>{licenseName}</span>
          </a>
        );
      })}
    </div>
  </div>
)}
